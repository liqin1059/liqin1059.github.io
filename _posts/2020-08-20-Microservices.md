---
layout: post
title: 微服务
date: 2020-08-20 12:31:30
categories: javascript
tags:
- nodejs
---
# 概述

## 什么是微服务

在传统的Web开发中，不会去区分前端后端，项目放在一个很大的仓库当中，面临的问题也随之而来

- 仓库越来越大
- 技术栈单一
- 某个功能奔溃会导致全部项目奔溃
- 项目难管理，代码冲突等等

那么为了向更细小的方向划分业务，就出现了微服务，微服务本身不是什么新技术，只是随着业务的不断发展，对业务不断分层，不断拆分。它被业界公认为云计算时代互联网应用的主要构建方式，是每一位技术人员必须面对的主题。它的概念如下

<!-- more -->
- 微服务是系统或应用程序中的自包含独立组件。每个微服务都应该有明确的作用域和责任，理想情况下，一个微服务只做一件事。它应该是无状态的或有状态的，如果它是有状态的，它应该带有自己的持久层（即数据库），不与其他服务共享。软件开发团队基于微服务架构以更分散的方式开发可重用的独立组件。他们可以为每个微服务使用自定义框架、依赖关系集，甚至是完全不同的编程语言。微服务也有助于实现可扩展性，因为它们本质上是分布式的，并且每个微服务都可以独立增长或复制。

## 容器和微服务

容器是在操作系统中建立隔离上下文的一种方法。实际上，这意味着它们中的每一个都有一个单独的包含了一组已安装的软件和相关配置的虚拟文件系统。由于它们是相互隔离的，因此任何容器都不能直接访问或影响其他容器或底层宿主操作系统。

创建容器的能力已经成为Linux操作系统的一部分，这种能力已经存在了很长一段时间，但直到2013年Docker的推出，容器才成为一种流行的技术。

当我们在谈论定义时，需要注意的是微服务和容器其实是不一样的东西，但这两个概念经常被放在一起谈论，就像API和微服务一样。如果没有容器，要么把服务器配置成可以运行多个微服务，让这些微服务不可避免地相互产生负面干扰，要么每个微服务都需要一个单独的服务器或自己的虚拟机，导致不必要的开销。因此，微服务通常被部署在一组由容器集群软件（如 Kubernetes）管理的一组容器中。可以肯定地说，容器和微服务的崛起其实是相互影响、相互促进的结果

## 微服务之间的通信

基于微服务架构构建的应用程序或API不仅要把自己完全暴露出来，还需要在内部组件（微服务）之间建立连接。由于每个微服务都可以使用不同的编程语言实现，我们需要依赖标准协议（如 HTTP）来建立微服务之间的连接。这个时候我们就回到了API上，所以从这里也可以知道 微服务是独立，可以使用任何技术去做，数据库也是相对独立的

最基本的形式是每个微服务都公开一个API，让其他服务可以向这个API发出请求并获取数据。也可以使用其他不同的方法，比如消息队列。微服务API是私有API，仅限用在单个应用程序中。它通常不提供公共URL，而是使用组织内部专用网络的私有IP或主机名，甚至是单个服务器集群内的IP或主机名。不过，这些API可以遵循类似公共API那样的设计范式或协议。而且，尽管它们的消费者数量有限，也应该遵循开发者体验的基本规则。也就是说，它们应该拥有相关的、一致的、可演化的API设计和文档，让其他团队（甚至是你自己）知道如何使用这些微服务。因此，你可以而且应该使用类似的工具来创建你的微服务API

当然，与更面向外部的 API 相比，在设计微服务 API 时有不同的侧重点
<img src="/assets/img/microservice.png">

微服务和API是不同的东西，就像微服务和容器也不是同一种东西一样。不过，这两个概念以两种不同的方式协同工作：首先，微服务可以作为部署内部、合作伙伴或公共API后端的一种方法。其次，微服务通常依赖API作为与语言无关的通信手段，以便在内部网络中相互通信。开发团队可以使用相似的方法和工具来创建公开API和微服务API

# 网关和微服务

我们上面说过了微服务是部署在每个独立的容器当中，但是所有的微服务实际上在一个局域网之内，通信是靠HTTP相互调用微服务暴露出来的API,但是微服务是一定要暴露给外部用的，所以这里出现了API网关

<img src="/assets/img/wanguan.png">

在之前呢，不论是手机或者浏览器都是要直接调用整个服务服务，而现在是调用网关，网关说白了就是暴露给外网的一套API接口，或者说门神，然后网关再去调用一个一个微服务，而关于服务器有关的限流，熔断，负载均衡都能在网关这里去做，也是防止一个服务导致整个项目奔溃的解决方案